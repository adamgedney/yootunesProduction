/*
 * grunt
 * http://gruntjs.com/
 *
 * Copyright (c) 2014 "Cowboy" Ben Alman
 * Licensed under the MIT license.
 * https://github.com/gruntjs/grunt/blob/master/LICENSE-MIT
 */

function markup(e){return e=e||"",e=e.replace(/(\s|^)_(\S|\S[\s\S]+?\S)_(?=[\s,.!?]|$)/g,"$1"+"$2".underline),e=e.replace(/(\s|^)\*(\S|\S[\s\S]+?\S)\*(?=[\s,.!?]|$)/g,"$1"+"$2".bold),e}function format(e){return e=[].slice.call(e,0),e.length>0&&(e[0]=String(e[0])),util.format.apply(util,e)}function write(e){e=e||"",!log.muted&&!suppressOutput&&(hasLogged=!0,grunt.option("no-color")&&(e=colors.stripColors(e)),process.stdout.write(markup(e)))}function writeln(e){e=e||"",write(e+"\n")}var grunt=require("../grunt"),util=require("util"),log=module.exports={},colors=require("colors");log.initColors=function(){var e=grunt.util;grunt.option("no-color")&&(colors.mode="none",e.hooker.hook(console,"log",function(){var t=e.toArray(arguments);return e.hooker.filter(this,t.map(function(t){return e.kindOf(t)==="string"?colors.stripColors(t):t}))}))};var suppressOutput;log.muted=!1;var hasLogged;log.write=function(){return write(format(arguments)),log},log.writeln=function(){return writeln(format(arguments)),log},log.warn=function(){var e=format(arguments);return arguments.length>0?writeln(">> ".red+grunt.util._.trim(e).replace(/\n/g,"\n>> ".red)):writeln("ERROR".red),log},log.error=function(){return grunt.fail.errorcount++,log.warn.apply(log,arguments),log},log.ok=function(){var e=format(arguments);return arguments.length>0?writeln(">> ".green+grunt.util._.trim(e).replace(/\n/g,"\n>> ".green)):writeln("OK".green),log},log.errorlns=function(){var e=format(arguments);return log.error(log.wraptext(77,e)),log},log.oklns=function(){var e=format(arguments);return log.ok(log.wraptext(77,e)),log},log.success=function(){var e=format(arguments);return writeln(e.green),log},log.fail=function(){var e=format(arguments);return writeln(e.red),log},log.header=function(){var e=format(arguments);return hasLogged&&writeln(),writeln(e.underline),log},log.subhead=function(){var e=format(arguments);return hasLogged&&writeln(),writeln(e.bold),log},log.debug=function(){var e=format(arguments);return grunt.option("debug")&&writeln("[D] "+e.magenta),log},log.writetableln=function(e,t){return writeln(log.table(e,t)),log},log.writelns=function(){var e=format(arguments);return writeln(log.wraptext(80,e)),log},log.writeflags=function(e,t){var n;return Array.isArray(e)?n=log.wordlist(e):typeof e=="object"&&e&&(n=log.wordlist(Object.keys(e).map(function(t){var n=e[t];return t+(n===!0?"":"="+JSON.stringify(n))}))),writeln((t||"Flags")+": "+(n||"(none)".cyan)),log},log.verbose={},log.notverbose={},Object.keys(log).filter(function(e){return typeof log[e]=="function"}).forEach(function(e){log.verbose[e]=function(){return suppressOutput=!grunt.option("verbose"),log[e].apply(log,arguments),suppressOutput=!1,log.verbose},log.notverbose[e]=function(){return suppressOutput=grunt.option("verbose"),log[e].apply(log,arguments),suppressOutput=!1,log.notverbose}}),log.verbose.or=log.notverbose,log.notverbose.or=log.verbose,log.wordlist=function(e,t){return t=grunt.util._.defaults(t||{},{separator:", ",color:"cyan"}),e.map(function(e){return t.color?String(e)[t.color]:e}).join(t.separator)},log.uncolor=function(e){return e.replace(/\x1B\[\d+m/g,"")},log.wraptext=function(e,t){var n=[],r,i,s,o=[],u=0;while(r=t.match(/(?:(\x1B\[\d+m)|\n|(.))([\s\S]*)/)){t=r[3];if(r[1]){i=r[1],o.push(r[1]);continue}if(r[2]){u===0&&i&&o.push(i),o.push(r[2]),u++;if(u<=e||r[2]===" ")continue;s=o.lastIndexOf(" "),t=o.slice(s===-1?s:s+1).join("")+t,o=o.slice(0,s)}n.push(o.join("")),o=[],u=0}return n.push(o.join("")),n.join("\n")},log.table=function(e,t){var n=[];e.forEach(function(e,r){var i=log.wraptext(e,t[r]).split("\n");i.forEach(function(e,t){var i=n[t];i||(i=n[t]=[]),i[r]=e})});var r=[];return n.forEach(function(t){var n="",i;for(var s=0;s<t.length;s++){i=t[s]||"",n+=i;var o=e[s]-log.uncolor(i).length;o>0&&(n+=grunt.util.repeat(o," "))}r.push(n)}),r.join("\n")};