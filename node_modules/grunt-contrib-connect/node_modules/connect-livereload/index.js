module.exports=function(t){function i(){var e=["<!-- livereload script -->",'<script type="text/javascript">document.write(\'<script src="http://\''," + (location.host || 'localhost').split(':')[0]"," + ':"+n+'/livereload.js?snipver=1" type="text/javascript"><\\/script>\')',"</script>",""].join("\n");return e}function s(e){return e?~e.lastIndexOf("</body>"):!1}function o(e){return e?~e.lastIndexOf("/livereload.js?snipver=1"):!0}function u(e){var t=e.headers.accept;return t?~t.indexOf("html"):!1}function a(e){var t=e.url,n=!1;return t?(r.forEach(function(e){~t.indexOf(e)&&(n=!0)}),n):!0}var t=t||{},n=t.port||35729,r=t.excludeList||[".woff",".js",".css",".ico"];return function(e,t,n){var r=t.writeHead,f=t.write,l=t.end;if(!u(e)||a(e))return n();t.push=function(e){t.data=(t.data||"")+e},t.inject=t.write=function(e,n){t.write=f;if(e!==undefined){var r=e instanceof Buffer?e.toString(n):e;return(s(r)||s(t.data))&&!o(r)&&(!t.data||!o(t.data))?(t.push(r.replace(/<\/body>/,function(e){return i()+e})),!0):t.write(e,n)}return!0},t.end=function(e,n){t.writeHead=r,t.end=l;var i=t.inject(e,n);if(!i)return t.end(e,n);t.data!==undefined&&!t._header&&t.setHeader("content-length",Buffer.byteLength(t.data,n)),t.end(t.data,n)},n()}};