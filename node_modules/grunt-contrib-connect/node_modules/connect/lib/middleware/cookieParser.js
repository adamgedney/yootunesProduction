/*!
 * Connect - cookieParser
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var utils=require("./../utils"),cookie=require("cookie");module.exports=function(t){return function(n,r,i){if(n.cookies)return i();var s=n.headers.cookie;n.secret=t,n.cookies={},n.signedCookies={};if(s)try{n.cookies=cookie.parse(s),t&&(n.signedCookies=utils.parseSignedCookies(n.cookies,t),n.signedCookies=utils.parseJSONCookies(n.signedCookies)),n.cookies=utils.parseJSONCookies(n.cookies)}catch(o){return o.status=400,i(o)}i()}};