/*!
 * Connect - urlencoded
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

function noop(e,t,n){n()}var utils=require("../utils"),_limit=require("./limit"),qs=require("qs");exports=module.exports=function(e){e=e||{};var t=e.limit?_limit(e.limit):noop;return function(r,i,s){if(r._body)return s();r.body=r.body||{};if(!utils.hasBody(r))return s();if("application/x-www-form-urlencoded"!=utils.mime(r))return s();r._body=!0,t(r,i,function(t){if(t)return s(t);var n="";r.setEncoding("utf8"),r.on("data",function(e){n+=e}),r.on("end",function(){try{r.body=n.length?qs.parse(n,e):{},s()}catch(t){t.body=n,s(t)}})})}};