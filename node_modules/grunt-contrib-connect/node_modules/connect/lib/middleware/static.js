/*!
 * Connect - static
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var send=require("send"),utils=require("../utils"),parse=utils.parseUrl,url=require("url");exports=module.exports=function(e,t){t=t||{};if(!e)throw new Error("static() root path required");var n=!1!==t.redirect;return function(i,s,o){function f(){o(),a.resume()}function l(){if(!n)return f();var e=url.parse(i.originalUrl).pathname;s.statusCode=301,s.setHeader("Location",e+"/"),s.end("Redirecting to "+utils.escape(e)+"/")}function c(e){if(404==e.status)return f();o(e)}if("GET"!=i.method&&"HEAD"!=i.method)return o();var u=parse(i).pathname,a=utils.pause(i);send(i,u).maxage(t.maxAge||0).root(e).index(t.index||"index.html").hidden(t.hidden).on("error",c).on("directory",l).pipe(s)}},exports.mime=send.mime;