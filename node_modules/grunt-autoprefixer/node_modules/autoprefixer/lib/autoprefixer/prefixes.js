(function(){var e,t,n,r,i;i=require("./utils"),t=require("./processor"),n=require("./selector"),r=require("./value"),r.register(require("./hacks/gradient")),r.register(require("./hacks/fill-available")),n.register(require("./hacks/fullscreen")),n.register(require("./hacks/placeholder")),e=function(){function e(e,n){var r;this.data=e,this.browsers=n,r=this.preprocess(this.select(this.data)),this.add=r[0],this.remove=r[1],this.otherCache={},this.processor=new t(this)}return e.prototype.transitionProps=["transition","transition-property"],e.prototype.select=function(e){var t,n,r,s,o,u=this;o={add:{},remove:{}};for(s in e)r=e[s],t=r.browsers.map(function(e){var t;return t=e.split(" "),{browser:t[0]+" "+t[1],note:t[2]}}),t=t.filter(function(e){return u.browsers.isSelected(e.browser)}).map(function(e){var t;return t=u.browsers.prefix(e.browser),e.note?t+" "+e.note:t}),t=i.uniq(t).sort(function(e,t){return t.length-e.length}),n=r.browsers.map(function(e){return u.browsers.prefix(e)}),r.mistakes&&(n=n.concat(r.mistakes)),n=i.uniq(n),t.length?(o.add[s]=t,t.length<n.length&&(o.remove[s]=n.filter(function(e){return t.indexOf(e)===-1}))):o.remove[s]=n;return o},e.prototype.preprocess=function(e){var t,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;t={selectors:[]},T=e.add;for(i in T){a=T[i];if(this.data[i].selector)t.selectors.push(n.load(i,a));else{l=this.data[i].transition?this.transitionProps:this.data[i].props;if(l){p=r.load(i,a);for(d=0,y=l.length;d<y;d++)f=l[d],t[f]||(t[f]={}),t[f].values||(t[f].values=[]),t[f].values.push(p)}this.data[i].props||(t[i]||(t[i]={}),t[i].prefixes=a)}}c={selectors:[]},N=e.remove;for(i in N){a=N[i];if(this.data[i].selector){h=n.load(i,a);for(v=0,b=a.length;v<b;v++)o=a[v],c.selectors.push(h.prefixed(o))}else{l=this.data[i].transition?this.transitionProps:this.data[i].props;if(l){p=r.load(i);for(m=0,w=a.length;m<w;m++){o=a[m],s=p.old(o);for(g=0,E=l.length;g<E;g++)f=l[g],c[f]||(c[f]={}),c[f].values||(c[f].values=[]),c[f].values.push(s)}}if(!this.data[i].props)for(x=0,S=a.length;x<S;x++)o=a[x],u=o+i,c[u]||(c[u]={}),c[u].remove=!0}}return[t,c]},e.prototype.other=function(e){var t;return(t=this.otherCache)[e]||(t[e]=this.browsers.prefixes().filter(function(t){return t!==e}))},e.prototype.each=function(e,t){var n,r,i,s,o;if(this.add[e]&&this.add[e].prefixes){s=this.add[e].prefixes,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(t(n));return o}},e.prototype.isCustom=function(e){return this.browsers.prefixes().indexOf(e)===-1},e.prototype.values=function(e,t){var n,r,s,o,u;return n=this[e],r=(o=n["*"])!=null?o.values:void 0,s=(u=n[t])!=null?u.values:void 0,r&&s?i.uniq(r.concat(s)):r||s||[]},e.prototype.toRemove=function(e){var t;return(t=this.remove[e])!=null?t.remove:void 0},e}(),module.exports=e}).call(this);